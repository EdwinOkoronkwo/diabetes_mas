graph TD
    subgraph IOManager
        IM_Start([Start]) --> IM_Validate[Validate Input]
        IM_Validate --> IM_Check{Valid?}
        IM_Check -- No --> IM_Error[Return Error]
        IM_Check -- Yes --> IM_Augment[Augment Input]
        IM_Augment --> IM_End([Return State])
    end

    subgraph RetrievalAgent
        RA_Start([Start]) --> RA_Init[Init RagAgentState]
        RA_Init --> RA_Embed[Embed Query]
        RA_Embed --> RA_Retrieve[Retrieve Documents]
        RA_Retrieve --> RA_GenAnswer[Generate Answer]
        RA_GenAnswer --> RA_GenSummary[Generate Summary]
        RA_GenSummary --> RA_Update[Update Main State]
        RA_Update --> RA_End([Return State])
    end

    subgraph PredictiveAgent
        PA_Start([Start]) --> PA_Prep[Prepare Text from RAG]
        PA_Prep --> PA_ML[ML Model Prediction]
        PA_ML --> PA_Score[Get Risk Score]
        PA_Score --> PA_LLM[LLM Interpretation]
        PA_LLM --> PA_Plan[Generate Health Plan]
        PA_Plan --> PA_Result[Return Risk & Plan]
        PA_Result --> PA_End([Return Result])
    end

    subgraph ReflectionAgent
        Ref_Start([Start]) --> Ref_Review[Review Output]
        Ref_Review --> Ref_Check{Consistent?}
        Ref_Check -- No --> Ref_Flag[Flag Issues]
        Ref_Check -- Yes --> Ref_Safety[Safety Filter]
        Ref_Safety --> Ref_End([Return Final Output])
        Ref_Flag --> Ref_Safety
    end
